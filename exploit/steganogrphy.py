from PIL import Image

def ImgDecrypt(PathImg, _len):       # открываем файл для записи
    img = Image.open(PathImg)        # открываем изображение
    width = img.size[0]              # определяем ширину изображения
    height = img.size[1]             # определяем высоту изображения
    _h = int(height / 2);            # позиция подписи по высоте
    _w = int(width / 2);             # позиция подписи по ширине
    pix = img.load()                 # выгружаем значения пикселей

    count = 0
    lenBits = _len * 8
    decryptBinMsg = ""
    
    # расшифровка сообщения
    while (_h < height):
        for i in range(_w, width):
            b = pix[i, _h][1]

            if (count < lenBits):
                if ((b % 2) == 1):
                    decryptBinMsg = decryptBinMsg + "1"
                    if (count == 0):
                        decryptBinMsg = decryptBinMsg + "b"
                    count = count + 1
                else:
                    decryptBinMsg = decryptBinMsg + "0"
                    if (count == 0):
                        decryptBinMsg = decryptBinMsg + "b"
                    count = count + 1

            # если записали все биты из строки пикселей
            else:
                i = width
                break

        if (count < lenBits):
            _h = _h + 1
            _w = 0
        else:
            _h = height
            break

    #print("")
    #print("decryptBinMsg:", decryptBinMsg)
    #print("")

    m = int(decryptBinMsg, 2)
    decryptMsg = m.to_bytes((m.bit_length() + 7) // 8, "big").decode()
    #print("decryptMsg:", decryptMsg)
    #print("")
    print(decryptMsg)

    img.close()                      # закрываем изображение

#signature = input("Write your signature: ")
signature = "TEAM005_ABCDEFGHIGKLMNOPQRSTUVWXYZ1234567890qwertyuiop[]"         # подпись для шифрования
#print("signature:", signature)
#test_flag
#ImgEncrypt("C:/Channel/img.png", signature)
ImgDecrypt("F:/misc/LabsForUniversity/AD_ctf/GitRepo/test_steaganography_images/postcard_2.png", len(signature))